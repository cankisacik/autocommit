name: Streak Keeper

on:
  workflow_dispatch:
    inputs:
      commit_count:
        description: 'Number of commits (1-3)'
        required: false
        default: '1'
        type: choice
        options:
          - '1'
          - '2'
          - '3'
  
  schedule:
    - cron: '55 21 * * *'  # Runs daily at midnight Turkey time (21:00 UTC)

jobs:
  streak:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      
      - name: Configure Git
        run: |
          git config user.name "cankisacik"
          git config user.email "cankisacik@users.noreply.github.com"
      
      - name: Make commits
        run: |
          COUNT="${{ github.event.inputs.commit_count }}"
          COUNT="${{ github.event.inputs.commit_count }}"
          if [ -z "$COUNT" ] || [ "$COUNT" = "1" ]; then
            COUNT=$((RANDOM % 6 + 3))
          fi
          LETTERS="abcdefghijklmnopqrstuvwxyz"
          
          for i in $(seq 1 $COUNT); do
            if [ -f "STREAK.md" ]; then
              CURRENT_LENGTH=$(wc -c < STREAK.md | tr -d ' ')
            else
              CURRENT_LENGTH=0
            fi
            
            LETTER_INDEX=$((CURRENT_LENGTH % 26))
            LETTER=${LETTERS:$LETTER_INDEX:1}
            
            echo -n "$LETTER" >> STREAK.md
            
            git add STREAK.md
            git commit -m "streak: +$LETTER ($(date -u '+%Y-%m-%d %H:%M:%S UTC'))"
            
            if [ $i -lt $COUNT ]; then
              sleep 2
            fi
          done
      
      - name: Push changes
        run: git push
